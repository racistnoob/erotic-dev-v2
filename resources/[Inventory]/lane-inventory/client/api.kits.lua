Kits = {
    ["pistols"] = {
        ["pistolmk2"] = {
            {item = "WEAPON_PISTOL_MK2", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 150, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["deagle"] = {
            {item = "WEAPON_PISTOL50", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "50cal_rounds", amount = 150, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["heavypistol"] = {
            {item = "WEAPON_M45A1", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["sp"] = {
            {item = "WEAPON_SP45", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["combatpistol"] = {
            {item = "WEAPON_COMBATPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 7, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["vintage"] = {
            {item = "WEAPON_VINTAGEPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["usp"] = {
            {item = "WEAPON_USP45", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["1911"] = {
            {item = "WEAPON_1911", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["FNX45"] = {
            {item = "WEAPON_FNX45", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["glock17"] = {
            {item = "WEAPON_GLOCK17", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["glock18c"] = {
            {item = "WEAPON_GLOCK18C", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["xm3"] = {
            {item = "WEAPON_PISTOLXM3", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["ceramic"] = {
            {item = "WEAPON_CERAMICPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["ap"] = {
            {item = "WEAPON_APPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        }
    },
    ["ars"] = {
        ["hopout"] = {
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "WEAPON_SP45", primary = true, amount = 1, slot = 4},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "556_rounds", amount = 250, slot = 16},
            {item = "joint", amount = 15, slot = 5},
            {item = "WEAPON_762", primary = true, amount = 1, slot = 1},
            {item = "radio", amount = 1, slot = 30},
        },
        ["ak"] = {
            {item = "WEAPON_AK47", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["scarh"] = {
            {item = "WEAPON_SCARH", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["762"] = {
            {item = "WEAPON_762", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 20, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["m16"] = {
            {item = "WEAPON_TACTICALRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["heavyrifle"] = {
            {item = "WEAPON_HEAVYRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["g36"] = {
            {item = "WEAPON_SPECIALCARBINE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["bullpup"] = {
            {item = "WEAPON_BULLPUPRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["bullpupmk2"] = {
            {item = "WEAPON_BULLPUPRIFLE_MK2", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["mk18"] = {
            {item = "WEAPON_MK18", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
        },
        ["advrifle"] = {
            {item = "WEAPON_ADVANCEDRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["m60"] = {
            {item = "WEAPON_COMBATMG", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
    },
    ["smgs"] = {
        ["tec9"] = {
            {item = "WEAPON_MACHINEPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["draco"] = {
            {item = "WEAPON_COMPACTRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["mp5"] = {
            {item = "WEAPON_SMG_MK2", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["mpx"] = {
            {item = "WEAPON_MPX", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["uzi"] = {
            {item = "WEAPON_MICROSMG", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["skorpion"] = {
            {item = "WEAPON_MINISMG", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["tommy"] = {
            {item = "WEAPON_GUSENBERG", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["magpull"] = {
            {item = "WEAPON_ASSAULTSMG", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
    },
    ["snipers"] = {
        ["trick"] = {
            {item = "WEAPON_HEAVYSNIPER_MK2", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "deluxo", amount = 1, slot = 4},
            {item = "50cal_rounds", amount = 150, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
        ["trick2"] = {
            {item = "WEAPON_MARKSMANRIFLE_MK2", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 15, slot = 3},
            {item = "joint", amount = 15, slot = 5},
            {item = "deluxo", amount = 1, slot = 4},
            {item = "50cal_rounds", amount = 150, slot = 15},
            {item = "radio", amount = 1, slot = 30},
        },
    }
}

local pairs = pairs
local kitNames = {}
for k,v in pairs(Kits) do
    local categoryNames = {}

    for i,j in pairs(v) do
        table.insert(categoryNames, i)
         -- makes commands for all the kits (/usp, /deagle etc ..)
        RegisterCommand(i, function(source,args,rawcommand)
            DoKitStuff(k, i)
         end)
    end

    kitNames[k] = categoryNames
end

-- makes a command to list all loadouts under each category (/snipers, /smg etc..)
for i, v in pairs(kitNames) do
    RegisterCommand(i, function(source,args,rawcommand)

        local message = '<div class="chat-message" style="border-left: calc(0.092592592vh * 2) solid #8abfff;"> <b style="font-weight: 300; color: #8abfff; text-shadow: 0px 0px calc(.092592592vh * 11.1000003815) #8abfff;">['..string.upper(i)..']: </b> <b1>'
        for k, j in pairs(v) do
            message = message .. j
            if next(v, k) then
                message = message .. ', '
            end
        end        
        message = message .. '</b1></div>'
        TriggerEvent('chat:addMessage', {
            template = message,
            args = {}
        })
    end, false)
end

RegisterNetEvent("inventory:forceKit", function(genre, kit)
    local kit = Kits[genre][kit]
    for k,v in pairs(kit) do API.GiveItem(v.item, v.amount, v.slot) end 
    local primary = API.FindPrimaryWeapon(kit)
    local ammoCount = API.GetKitAmmo(kit)
    GiveWeaponToPed(Player.Ped(), GetHashKey(primary), 0, false, true)
    TriggerEvent("attachments:applyComponents", primary)
    SetPedAmmo(Player.Ped(), GetHashKey(primary), ammoCount)
    Wait(0)
    SetAmmoInClip(Player.Ped(), GetHashKey(primary), 999)
end)

function API.ClearItems()
    RemoveAllPedWeapons(Player.Ped())
    TriggerServerEvent("zbrp:Player:clearItems")
end


function DoKitStuff(genre, kit)
    local worldSettings = exports['erotic-lobby']:getLobbySettings()
    local isGenreAllowed = true
    if worldSettings.kits then
        isGenreAllowed = false
        for _, kit in ipairs(worldSettings.kits) do
            if genre == kit then
                isGenreAllowed = true
                break
            end
        end
        if not isGenreAllowed then
            TriggerEvent('chat:addMessage', {
                template = '<div class="chat-message" style="border-left: calc(0.092592592vh * 2) solid #ff908a;"><b2>{0}:</b2> <b style="color: #ff908a; text-shadow: 0px 0px calc(.092592592vh * 11.1000003815) #ff908a;">{1}</b1></div>',
                args = { "[EROTIC]", "This gun category is disabled in this lobby." }
            })
            return
        end
    end
    Player.CurrentKitGenre = genre
    Player.CurrentKit = kit
    API.ClearItems()
    Wait(500)
    API.GiveKit()
end

exports("DoKitStuff", DoKitStuff)

--[[ WEAPON FUNCTIONS
-- FIND PRIMARY WEAPON (KIT)
-- FIND AMMO COUNT (KIT)
]]

function API.FindPrimaryWeapon(kit)
    local result = "WEAPON_UNARMED"
    local worldSettings = exports['erotic-lobby']:getLobbySettings()
    for k,v in pairs(kit) do
        if v.primary then
            if v.item == "WEAPON_M45A1" or v.item == "WEAPON_HEAVYPISTOL" then
                local carfightrecoil = worldSettings.recoilMode == "roleplay3"
                v.item = carfightrecoil and "WEAPON_M45A1" or not carfightrecoil and "WEAPON_HEAVYPISTOL"
            end
            result = v.item
        end
    end
    return result 
end

function API.GetKitAmmo(kit) 
    local result = 0 
    local primary = API.FindPrimaryWeapon(kit)
    local ammo = findAmmoType(GetHashKey(primary))
    for k,v in pairs(kit) do 
        -- print(v.item)
        if v.item == ammo then result = result + v.amount end 
    end
    return result
end

function API.GiveKit()
    local kit = Kits[Player.CurrentKitGenre][Player.CurrentKit]
    local worldSettings = exports['erotic-lobby']:getLobbySettings()
    for k,v in pairs(kit) do
        if v.item == "WEAPON_M45A1" or v.item == "WEAPON_HEAVYPISTOL" then
            local carfightrecoil = worldSettings.recoilMode == "roleplay3"
            v.item = carfightrecoil and "WEAPON_M45A1" or not carfightrecoil and "WEAPON_HEAVYPISTOL"
        end
        API.GiveItem(v.item, v.amount, v.slot)
    end
    local primary = API.FindPrimaryWeapon(kit)
    local ammoCount = API.GetKitAmmo(kit)
    GiveWeaponToPed(Player.Ped(), GetHashKey(primary), 0, false, true)
    exports["attachments"]:applyComponents(primary)
    SetPedAmmo(Player.Ped(), GetHashKey(primary), ammoCount)
    Wait(0)
    SetAmmoInClip(Player.Ped(), GetHashKey(primary), 999)
end
exports("GiveKit", API.GiveKit)

-- SWAPPING SLOTS FUNCTIONS 
-- HAS REQUIRED ITEMS FOR KITS 
-- ACTUAL SWAP
-- FIND KEY FROM ITEM NAME

function API.HasRequiredItems(kit)
    for k,v in pairs(kit) do 
        if not API.HasItem(v.item) then return false end 
    end
    return true 
end

function API.FindViaItem(item, kit)
    for k,v in pairs(kit) do 
        if v.item == item then return k end 
    end
    return false 
end

function API.SwapSlots(fromslot, toslot, fromdata, todata)
    local kit = Kits[Player.CurrentKitGenre][Player.CurrentKit]
    if not API.HasRequiredItems(kit) then return end 
    local fromKey = API.FindViaItem(fromdata.item, kit)
    local toKey = API.FindViaItem(todata.item, kit)
    kit[fromKey].slot = toslot
    kit[toKey].slot = fromslot
end


function API.SwapToEmpty(data)
    local kit = Kits[Player.CurrentKitGenre][Player.CurrentKit]
    if not API.HasRequiredItems(kit) then return end 
    local item = API.GetItemInSlot(data.index)
    local key = API.FindViaItem(item, kit)
    if not key then return end 
    kit[key].slot = data.droppedTo 
end

-- EVENTS AND CALLBACKS

-- RegisterNUICallback("nui:zbrp:moveInside", API.SwapToEmpty)
RegisterNetEvent("inventory.api:SwapSlots", API.SwapSlots) -- swap item to item 
RegisterNetEvent("inventory.api:GiveKit", API.GiveKit)
RegisterNetEvent("inventory.api:ClearItems", API.ClearItems)